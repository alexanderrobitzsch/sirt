<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimates a user defined item response model. Both, item response functions
and latent trait distributions can be specified by the user (see Details).
By default, the EM algorithm is used for estimation. The number of maximum
EM iterations can be defined with the argument maxit. The xxirt
function also allows Newton-Raphson optimization by specifying values of maximum
number of iterations in maxit_nr larger than zero. Typically, a small initial
number of EM iterations should be chosen to obtain reasonable starting values."><title>User Defined Item Response Model — xxirt • sirt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="User Defined Item Response Model — xxirt"><meta property="og:description" content="Estimates a user defined item response model. Both, item response functions
and latent trait distributions can be specified by the user (see Details).
By default, the EM algorithm is used for estimation. The number of maximum
EM iterations can be defined with the argument maxit. The xxirt
function also allows Newton-Raphson optimization by specifying values of maximum
number of iterations in maxit_nr larger than zero. Typically, a small initial
number of EM iterations should be chosen to obtain reasonable starting values."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sirt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2</small

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/alexanderrobitzsch/sirt/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>User Defined Item Response Model</h1>
      
      <div class="d-none name"><code>xxirt.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates a user defined item response model. Both, item response functions
and latent trait distributions can be specified by the user (see Details).
By default, the EM algorithm is used for estimation. The number of maximum
EM iterations can be defined with the argument <code>maxit</code>. The <code>xxirt</code>
function also allows Newton-Raphson optimization by specifying values of maximum
number of iterations in <code>maxit_nr</code> larger than zero. Typically, a small initial
number of EM iterations should be chosen to obtain reasonable starting values.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">xxirt</span><span class="op">(</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="cn">NULL</span>, itemtype<span class="op">=</span><span class="cn">NULL</span>, customItems<span class="op">=</span><span class="cn">NULL</span>, partable<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>       customTheta<span class="op">=</span><span class="cn">NULL</span>, group<span class="op">=</span><span class="cn">NULL</span>, weights<span class="op">=</span><span class="cn">NULL</span>, globconv<span class="op">=</span><span class="fl">1e-06</span>, conv<span class="op">=</span><span class="fl">1e-04</span>,</span>
<span>       maxit<span class="op">=</span><span class="fl">1000</span>, mstep_iter<span class="op">=</span><span class="fl">4</span>, mstep_reltol<span class="op">=</span><span class="fl">1e-06</span>, maxit_nr<span class="op">=</span><span class="fl">0</span>, optimizer_nr<span class="op">=</span><span class="st">"nlminb"</span>,</span>
<span>       estimator<span class="op">=</span><span class="st">"ML"</span>, control_nr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, h<span class="op">=</span><span class="fl">1E-4</span>, use_grad<span class="op">=</span><span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>       penalty_fun_item<span class="op">=</span><span class="cn">NULL</span>, np_fun_item<span class="op">=</span><span class="cn">NULL</span>, penalty_fun_theta<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>       np_fun_theta<span class="op">=</span><span class="cn">NULL</span>, pml_args<span class="op">=</span><span class="cn">NULL</span>, verbose_index<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>       cv_kfold<span class="op">=</span><span class="fl">0</span>, cv_maxit<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, digits<span class="op">=</span><span class="fl">3</span>, file<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">parm</span>, level<span class="op">=</span><span class="fl">.95</span>, <span class="va">...</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.expectedCounts.html" class="external-link">IRT.expectedCounts</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.factor.scores.html" class="external-link">IRT.factor.scores</a></span><span class="op">(</span><span class="va">object</span>, type<span class="op">=</span><span class="st">"EAP"</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.irfprob.html" class="external-link">IRT.irfprob</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.likelihood.html" class="external-link">IRT.likelihood</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.likelihood.html" class="external-link">IRT.posterior</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.modelfit.html" class="external-link">IRT.modelfit</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for IRT.modelfit.xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for xxirt</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/vcov.html" class="external-link">IRT.se</a></span><span class="op">(</span><span class="va">object</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># computes Hessian matrix</span></span>
<span><span class="fu">xxirt_hessian</span><span class="op">(</span><span class="va">object</span>, h<span class="op">=</span><span class="fl">1e-4</span>, use_shortcut<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#- sandwich estimate for pairwise maximum likelihood estimation</span></span>
<span><span class="fu">xxirt_sandwich_pml</span><span class="op">(</span><span class="va">object</span>, h<span class="op">=</span><span class="fl">1e-4</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dat</dt>
<dd><p>Data frame with item responses</p></dd>

  <dt>Theta</dt>
<dd><p>Matrix with \(\bold{\theta}\) grid vector of latent trait</p></dd>

  <dt>itemtype</dt>
<dd><p>Vector of item types</p></dd>

  <dt>customItems</dt>
<dd><p>List containing types of item response functions created by
<code><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></code>.</p></dd>

 <dt>partable</dt>
<dd><p>Item parameter table which is initially created by
<code><a href="xxirt_createParTable.html">xxirt_createParTable</a></code> and which can be modified by
<code><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></code>.</p></dd>

  <dt>customTheta</dt>
<dd><p>User defined \(\bold{\theta}\) distribution created by
<code><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></code>.</p></dd>

  <dt>group</dt>
<dd><p>Optional vector of group indicators</p></dd>

  <dt>weights</dt>
<dd><p>Optional vector of person weights</p></dd>

  <dt>globconv</dt>
<dd><p>Convergence criterion for relative change in deviance</p></dd>

  <dt>conv</dt>
<dd><p>Convergence criterion for absolute change in parameters</p></dd>

  <dt>maxit</dt>
<dd><p>Maximum number of iterations in the EM algorithm</p></dd>

  <dt>mstep_iter</dt>
<dd><p>Maximum number of iterations in M-step</p></dd>

  <dt>mstep_reltol</dt>
<dd><p>Convergence criterion in M-step</p></dd>

<dt>maxit_nr</dt>
<dd><p>Number of Newton-Raphson iterations after EM algorithm</p></dd>

<dt>optimizer_nr</dt>
<dd><p>Type of optimizer for Newton-Raphson optimization.
Alternatives are <code>"optim"</code> or <code>"nlminb"</code> or other options of
<code><a href="sirt-utilities.html">sirt_optimizer</a></code>.</p></dd>

<dt>estimator</dt>
<dd><p>Marginal maximum likelihood (<code>"ML"</code>) or pairwise
maximum likelihood (<code>"PML"</code>)</p></dd>

<dt>control_nr</dt>
<dd><p>Argument <code>control</code> for optimizer.</p></dd>

<dt>h</dt>
<dd><p>Numerical differentiation parameter</p></dd>

<dt>use_grad</dt>
<dd><p>Logical indicating whether the gradient should be supplied
to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim</a></code></p></dd>

  <dt>verbose</dt>
<dd><p>Logical indicating whether iteration progress should be displayed</p></dd>

<dt>penalty_fun_item</dt>
<dd><p>Optional penalty function used in regularized
estimation. Used as a function of <code>x</code> (vector of item parameters)</p></dd>

<dt>np_fun_item</dt>
<dd><p>Function that counts the number of item parameters in regularized
estimation. Used as a function of <code>x</code> (vector of item parameters)</p></dd>

<dt>penalty_fun_theta</dt>
<dd><p>Optional penalty function used in regularized
estimation. Used as a function of <code>x</code> (vector of theta parameters)</p></dd>

<dt>np_fun_theta</dt>
<dd><p>Function that counts the number of theta parameters in regularized
estimation. Used as a function of <code>x</code> (vector of theta parameters)</p></dd>

<dt>object</dt>
<dd><p>Object of class <code>xxirt</code></p></dd>

<dt>digits</dt>
<dd><p>Number of digits to be rounded</p></dd>

<dt>file</dt>
<dd><p>Optional file name to which <code>summary</code> output is written</p></dd>

<dt>parm</dt>
<dd><p>Optional vector of parameters</p></dd>

<dt>level</dt>
<dd><p>Confidence level</p></dd>

<dt>pml_args</dt>
<dd><p>Weight matrices for <code>estimator="PML"</code></p></dd>

<dt>verbose_index</dt>
<dd><p>Logical indicating whether item index should be
printed in estimation output</p></dd>

<dt>cv_kfold</dt>
<dd><p>Number of k folds in cross validation. The default is 0 (no
cross-validation)</p></dd>

<dt>cv_maxit</dt>
<dd><p>Maximum number of iterations for each cross-validation sample</p></dd>

<dt>x</dt>
<dd><p>Object of class <code>xxirt</code></p></dd>

<dt>type</dt>
<dd><p>Type of person parameter estimate. Currently, only
<code>EAP</code> is implemented.</p></dd>

<dt>use_shortcut</dt>
<dd><p>Logical indicating whether a shortcut in the computation
should be utilized</p></dd>

<dt>...</dt>
<dd><p>Further arguments to be passed</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Item response functions can be specified as functions of unknown parameters
\(\bold{\delta}_i\) such that
\(P(X_{i}=x | \bold{\theta})=f_i( x | \bold{\theta} ; \bold{\delta}_i  )\)
The item response model is estimated under the assumption of
local stochastic independence of items. Equality constraints of
item parameters \(\bold{\delta}_i\) among items are allowed.</p>
<p>The probability distribution \(P(\bold{\theta})\) are specified as functions
of an unknown parameter vector \(\bold{\gamma}\).</p>
<p>A penalty function for item parameters can be specified in
<code>penalty_fun_item</code>. The penalty function should be differentiable and
a non-differentiable function (e.g., the absolute value function) should
be approximated by a differentiable function.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>List with following entries</p>
<dl><dt>partable</dt>
<dd><p>Item parameter table</p></dd>

<dt>par_items</dt>
<dd><p>Vector with estimated item parameters</p></dd>

<dt>par_items_summary</dt>
<dd><p>Data frame with item parameters</p></dd>

<dt>par_items_bounds</dt>
<dd><p>Data frame with summary on bounds of estimated
 item parameters</p></dd>

<dt>par_Theta</dt>
<dd><p>Vector with estimated parameters of theta distribution</p></dd>

<dt>Theta</dt>
<dd><p>Matrix with \(\bold{\theta}\) grid</p></dd>

<dt>probs_items</dt>
<dd><p>Item response functions</p></dd>

<dt>probs_Theta</dt>
<dd><p>Theta distribution</p></dd>

<dt>deviance</dt>
<dd><p>Deviance</p></dd>

<dt>loglik</dt>
<dd><p>Log likelihood value</p></dd>

<dt>ic</dt>
<dd><p>Information criteria</p></dd>

<dt>item_list</dt>
<dd><p>List with item functions</p></dd>

<dt>customItems</dt>
<dd><p>Used customized item response functions</p></dd>

<dt>customTheta</dt>
<dd><p>Used customized theta distribution</p></dd>

<dt>cv_loglike</dt>
<dd><p>Cross-validated log-likelihood value (if <code>cv_kfold&gt;0</code>)</p></dd>

<dt>p.xi.aj</dt>
<dd><p>Individual likelihood</p></dd>

<dt>p.aj.xi</dt>
<dd><p>Individual posterior</p></dd>

<dt>ll_case</dt>
<dd><p>Case-wise log-likelihood values</p></dd>

<dt>n.ik</dt>
<dd><p>Array of expected counts</p></dd>

<dt>EAP</dt>
<dd><p>EAP person parameter estimates</p></dd>

<dt>dat</dt>
<dd><p>Used dataset with item responses</p></dd>

<dt>dat_resp</dt>
<dd><p>Dataset with response indicators</p></dd>

<dt>weights</dt>
<dd><p>Vector of person weights</p></dd>

<dt>G</dt>
<dd><p>Number of groups</p></dd>

<dt>group</dt>
<dd><p>Integer vector of group indicators</p></dd>

<dt>group_orig</dt>
<dd><p>Vector of original group_identifiers</p></dd>

<dt>ncat</dt>
<dd><p>Number of categories per item</p></dd>

<dt>converged</dt>
<dd><p>Logical whether model has converged</p></dd>

<dt>iter</dt>
<dd><p>Number of iterations needed</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See the <code><a href="https://rdrr.io/pkg/mirt/man/createItem.html" class="external-link">mirt::createItem</a></code> and
<code><a href="https://rdrr.io/pkg/mirt/man/mirt.html" class="external-link">mirt::mirt</a></code> functions in the <span class="pkg">mirt</span>
package for similar functionality.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co">## EXAMPLE 1: Unidimensional item response functions</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.read</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">data.read</span></span>
<span></span>
<span><span class="co">#------ Definition of item response functions</span></span>
<span></span>
<span><span class="co">#*** IRF 2PL</span></span>
<span><span class="va">P_2PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">P</span><span class="op">[</span>,<span class="va">cc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="op">(</span><span class="va">cc</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">a</span> <span class="op">*</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">b</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#*** IRF 1PL</span></span>
<span><span class="va">P_1PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">P</span><span class="op">[</span>,<span class="va">cc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="op">(</span><span class="va">cc</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">b</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#** created item classes of 1PL and 2PL models</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"a"</span><span class="op">=</span><span class="fl">1</span>, <span class="st">"b"</span><span class="op">=</span><span class="fl">0</span> <span class="op">)</span></span>
<span><span class="co"># define some slightly informative prior of 2PL</span></span>
<span><span class="va">item_2PL</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"2PL"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               P<span class="op">=</span><span class="va">P_2PL</span>, prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="st">"dlnorm"</span><span class="op">)</span>, prior_par1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> a<span class="op">=</span><span class="fl">0</span> <span class="op">)</span>,</span>
<span>               prior_par2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">item_1PL</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"1PL"</span>, par<span class="op">=</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               P<span class="op">=</span><span class="va">P_1PL</span> <span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_1PL</span>,  <span class="va">item_2PL</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#---- definition theta distribution</span></span>
<span></span>
<span><span class="co">#** theta grid</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>,<span class="fl">6</span>,length<span class="op">=</span><span class="fl">21</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#** theta distribution</span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fl">0</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">G</span><span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu</span>, sd<span class="op">=</span><span class="va">sigma</span> <span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="va">pi1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pi1</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pi1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pi_Theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#** create distribution class</span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"mu"</span><span class="op">=</span><span class="fl">0</span>, <span class="st">"sigma"</span><span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                       P<span class="op">=</span><span class="va">P_Theta1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 1: Rasch model</span></span>
<span></span>
<span><span class="co">#-- create parameter table</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"1PL"</span>, <span class="fl">12</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                        customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate model</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate Rasch model by providing starting values</span></span>
<span><span class="va">partable1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></span><span class="op">(</span> <span class="va">partable</span>, parname<span class="op">=</span><span class="st">"b"</span>,</span>
<span>                   value<span class="op">=</span><span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># estimate model again</span></span>
<span><span class="va">mod1b</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable1</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1b</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract coefficients, covariance matrix and standard errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod1b</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod1b</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/vcov.html" class="external-link">IRT.se</a></span><span class="op">(</span><span class="va">mod1b</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#** start with EM and finalize with Newton-Raphson algorithm</span></span>
<span><span class="va">mod1c</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span>,</span>
<span>                   maxit<span class="op">=</span><span class="fl">20</span>, maxit_nr<span class="op">=</span><span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1c</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 2: 2PL Model with three groups of item discriminations</span></span>
<span></span>
<span><span class="co">#-- create parameter table</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"2PL"</span>, <span class="fl">12</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>, customItems<span class="op">=</span><span class="va">customItems</span><span class="op">)</span></span>
<span><span class="co"># modify parameter table: set constraints for item groups A, B and C</span></span>
<span><span class="va">partable1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></span><span class="op">(</span><span class="va">partable</span>, item<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>                         parname<span class="op">=</span><span class="st">"a"</span>, parindex<span class="op">=</span><span class="fl">111</span><span class="op">)</span></span>
<span><span class="va">partable1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></span><span class="op">(</span><span class="va">partable1</span>, item<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"B"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>                         parname<span class="op">=</span><span class="st">"a"</span>, parindex<span class="op">=</span><span class="fl">112</span><span class="op">)</span></span>
<span><span class="va">partable1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></span><span class="op">(</span><span class="va">partable1</span>, item<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>                         parname<span class="op">=</span><span class="st">"a"</span>, parindex<span class="op">=</span><span class="fl">113</span><span class="op">)</span></span>
<span><span class="co"># delete prior distributions</span></span>
<span><span class="va">partable1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></span><span class="op">(</span><span class="va">partable1</span>, parname<span class="op">=</span><span class="st">"a"</span>, prior<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#-- fix sigma to 1</span></span>
<span><span class="va">customTheta1</span> <span class="op">&lt;-</span> <span class="va">customTheta</span></span>
<span><span class="va">customTheta1</span><span class="op">$</span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span><span class="op">=</span><span class="cn">FALSE</span>,<span class="st">"sigma"</span><span class="op">=</span><span class="cn">FALSE</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate model</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable1</span>,</span>
<span>                  customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta1</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 3: Cloglog link function</span></span>
<span></span>
<span><span class="co">#*** IRF cloglog</span></span>
<span><span class="va">P_1N</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">Theta</span> <span class="op">-</span> <span class="va">b</span> <span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">P</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">item_1N</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"1N"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                    P<span class="op">=</span><span class="va">P_1N</span> <span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_1N</span> <span class="op">)</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"1N"</span>, <span class="va">I</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                      customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></span><span class="op">(</span> partable<span class="op">=</span><span class="va">partable</span>, parname<span class="op">=</span><span class="st">"b"</span>,</span>
<span>                 value<span class="op">=</span><span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span> <span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#*** estimate model</span></span>
<span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>, customItems<span class="op">=</span><span class="va">customItems</span>,</span>
<span>                customTheta<span class="op">=</span><span class="va">customTheta</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.compareModels.html" class="external-link">IRT.compareModels</a></span><span class="op">(</span><span class="va">mod1</span>,<span class="va">mod3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 4: Latent class model</span></span>
<span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># number of classes</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#*** Theta distribution</span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span>  <span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logitprobs</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">logitprobs</span>, <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">l1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fl">1</span><span class="op">/</span><span class="va">K</span>, <span class="va">K</span><span class="op">-</span><span class="fl">1</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_Theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"pi"</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>,</span>
<span>                     est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_Theta1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#*** IRF latent class</span></span>
<span><span class="va">P_lc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">P</span><span class="op">[</span>,<span class="va">cc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">Theta</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, length<span class="op">=</span><span class="va">K</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"b"</span>,<span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="va">item_lc</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"LC"</span>, par<span class="op">=</span><span class="va">par</span>,</span>
<span>                 est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="va">K</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_lc</span> <span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_lc</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># create parameter table</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"LC"</span>, <span class="fl">12</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>, customItems<span class="op">=</span><span class="va">customItems</span><span class="op">)</span></span>
<span><span class="va">partable</span></span>
<span></span>
<span><span class="co">#*** estimate model</span></span>
<span><span class="va">mod4</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>, customItems<span class="op">=</span><span class="va">customItems</span>,</span>
<span>                customTheta<span class="op">=</span><span class="va">customTheta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod4</span><span class="op">)</span></span>
<span><span class="co"># class probabilities</span></span>
<span><span class="va">mod4</span><span class="op">$</span><span class="va">probs_Theta</span></span>
<span><span class="co"># item response functions</span></span>
<span><span class="va">imod4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.irfprob.html" class="external-link">IRT.irfprob</a></span><span class="op">(</span> <span class="va">mod5</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span> <span class="va">imod4</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span>, <span class="fl">3</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 5: Ordered latent class model</span></span>
<span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># number of classes</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">Theta</span>, <span class="fl">1</span>, <span class="va">cumsum</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#*** Theta distribution</span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span>  <span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logitprobs</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">logitprobs</span>, <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">l1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fl">1</span><span class="op">/</span><span class="va">K</span>, <span class="va">K</span><span class="op">-</span><span class="fl">1</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_Theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"pi"</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>,</span>
<span>                est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_Theta1</span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#*** IRF ordered latent class</span></span>
<span><span class="va">P_olc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">P</span><span class="op">[</span>,<span class="va">cc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">Theta</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fl">.5</span>,, length<span class="op">=</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"b"</span>,<span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="va">item_olc</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"OLC"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="va">K</span><span class="op">)</span>,</span>
<span>                    P<span class="op">=</span><span class="va">P_olc</span>, lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="op">-</span><span class="cn">Inf</span>, <span class="fl">0</span>, <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_olc</span> <span class="op">)</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"OLC"</span>, <span class="fl">12</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>, customItems<span class="op">=</span><span class="va">customItems</span><span class="op">)</span></span>
<span><span class="va">partable</span></span>
<span></span>
<span><span class="co">#*** estimate model</span></span>
<span><span class="va">mod5</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>, customItems<span class="op">=</span><span class="va">customItems</span>,</span>
<span>                customTheta<span class="op">=</span><span class="va">customTheta</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod5</span><span class="op">)</span></span>
<span><span class="co"># estimated item response functions</span></span>
<span><span class="va">imod5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.irfprob.html" class="external-link">IRT.irfprob</a></span><span class="op">(</span> <span class="va">mod5</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span> <span class="va">imod5</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span>, <span class="fl">3</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co">## EXAMPLE 2: Multiple group models with xxirt</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.math</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">data.math</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"M[A-Z]"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, value<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>,<span class="fl">8</span>,len<span class="op">=</span><span class="fl">31</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 1: Rasch model, single group</span></span>
<span></span>
<span><span class="co">#*** Theta distribution</span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span>  <span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu</span>, sd<span class="op">=</span><span class="va">sigma</span><span class="op">)</span></span>
<span>    <span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span>    <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">p1</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_Theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>,<span class="st">"sigma"</span><span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>,</span>
<span>                   est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_Theta1</span>  <span class="op">)</span></span>
<span><span class="va">customTheta</span></span>
<span></span>
<span><span class="co">#*** IRF 1PL logit</span></span>
<span><span class="va">P_1PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span> <span class="va">Theta</span> <span class="op">-</span> <span class="va">b</span> <span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">P</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">item_1PL</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"1PL"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_1PL</span><span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_1PL</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"1PL"</span>, <span class="va">I</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                       customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_modifyParTable</a></span><span class="op">(</span> partable<span class="op">=</span><span class="va">partable</span>, parname<span class="op">=</span><span class="st">"b"</span>,</span>
<span>                  value<span class="op">=</span><span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span> <span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#*** estimate model</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 2: Rasch model, multiple groups</span></span>
<span></span>
<span><span class="co">#*** Theta distribution</span></span>
<span><span class="va">P_Theta2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span>  <span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mu1</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">sigma1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">G</span><span class="op">)</span></span>
<span>    <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu1</span>, sd<span class="op">=</span><span class="va">sigma1</span><span class="op">)</span></span>
<span>    <span class="va">probs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span>    <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu2</span>, sd<span class="op">=</span><span class="va">sigma2</span><span class="op">)</span></span>
<span>    <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_Theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu1"</span>,<span class="st">"mu2"</span>,<span class="st">"sigma1"</span>,<span class="st">"sigma2"</span><span class="op">)</span></span>
<span><span class="va">customTheta2</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>,</span>
<span>                    est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_Theta2</span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">customTheta2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#*** estimate model</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span>, group<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">female</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>           customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta2</span>, maxit<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.compareModels.html" class="external-link">IRT.compareModels</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="va">mod2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#*** compare results with TAM package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.edmeasurementsurveys.com/TAM/Tutorials/" class="external-link">TAM</a></span><span class="op">)</span></span>
<span><span class="va">mod2b</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/TAM/man/tam.mml.html" class="external-link">tam.mml</a></span><span class="op">(</span> resp<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span>, group<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">female</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2b</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.compareModels.html" class="external-link">IRT.compareModels</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="va">mod2</span>, <span class="va">mod2b</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co">## EXAMPLE 3: Regularized 2PL model</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.read</span>, package<span class="op">=</span><span class="st">"sirt"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">data.read</span></span>
<span></span>
<span><span class="co">#------ Definition of item response functions</span></span>
<span></span>
<span><span class="co">#*** IRF 2PL</span></span>
<span><span class="va">P_2PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">P</span><span class="op">[</span>,<span class="va">cc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="op">(</span><span class="va">cc</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">a</span> <span class="op">*</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">b</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#** created item classes of 1PL and 2PL models</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"a"</span><span class="op">=</span><span class="fl">1</span>, <span class="st">"b"</span><span class="op">=</span><span class="fl">0</span> <span class="op">)</span></span>
<span><span class="co"># define some slightly informative prior of 2PL</span></span>
<span><span class="va">item_2PL</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"2PL"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               P<span class="op">=</span><span class="va">P_2PL</span>, prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="st">"dlnorm"</span><span class="op">)</span>, prior_par1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> a<span class="op">=</span><span class="fl">0</span> <span class="op">)</span>,</span>
<span>               prior_par2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_2PL</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#---- definition theta distribution</span></span>
<span></span>
<span><span class="co">#** theta grid</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>,<span class="fl">6</span>,length<span class="op">=</span><span class="fl">21</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#** theta distribution</span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fl">0</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">G</span><span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu</span>, sd<span class="op">=</span><span class="va">sigma</span> <span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="va">pi1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pi1</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pi1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pi_Theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#** create distribution class</span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"mu"</span><span class="op">=</span><span class="fl">0</span>, <span class="st">"sigma"</span><span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                       P<span class="op">=</span><span class="va">P_Theta1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 1: 2PL model</span></span>
<span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"2PL"</span>, <span class="fl">12</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                        customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 2: Regularized 2PL model with regularization on item loadings</span></span>
<span></span>
<span><span class="co"># define regularized estimation of item loadings</span></span>
<span><span class="va">parindex</span> <span class="op">&lt;-</span> <span class="va">partable</span><span class="op">[</span> <span class="va">partable</span><span class="op">$</span><span class="va">parname</span><span class="op">==</span><span class="st">"a"</span>,<span class="st">"parindex"</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#** penalty is defined by -N*lambda*sum_i (a_i-1)^2</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">.02</span></span>
<span><span class="va">penalty_fun_item</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">&lt;-</span> <span class="va">N</span><span class="op">*</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="op">(</span> <span class="va">x</span><span class="op">[</span><span class="va">parindex</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># estimate standard deviation</span></span>
<span><span class="va">customTheta1</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                       P<span class="op">=</span><span class="va">P_Theta1</span> <span class="op">)</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta1</span>,</span>
<span>                   penalty_fun_item<span class="op">=</span><span class="va">penalty_fun_item</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co">## EXAMPLE 4: 2PL mixture model</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="co">#*** simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">4000</span>   <span class="co"># number of persons</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fl">15</span>     <span class="co"># number of items</span></span>
<span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="fl">.25</span> <span class="co"># mixture proportion for second class</span></span>
<span></span>
<span><span class="co"># discriminations and difficulties in first class</span></span>
<span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">I</span><span class="op">)</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>,len<span class="op">=</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="co"># distribution in second class</span></span>
<span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fl">1.2</span></span>
<span><span class="co"># compute parameters with constraint N(0,1) in second class</span></span>
<span><span class="co"># a*(sigma*theta+mu-b)=a*sigma*(theta-(b-mu)/sigma)</span></span>
<span><span class="co">#=&gt; a2=a*sigma and b2=(b-mu)/sigma</span></span>
<span><span class="va">a2</span> <span class="op">&lt;-</span> <span class="va">a1</span></span>
<span><span class="va">a2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>  <span class="co"># some items with different discriminations</span></span>
<span><span class="va">a2</span> <span class="op">&lt;-</span> <span class="va">a2</span><span class="op">*</span><span class="va">sigma2</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="va">b1</span></span>
<span><span class="va">b2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># first 5 item with different difficulties</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">b2</span><span class="op">-</span><span class="va">mu2</span><span class="op">)</span><span class="op">/</span><span class="va">sigma2</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="sim.raschtype.html">sim.raschtype</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">prop</span><span class="op">)</span><span class="op">)</span>, b<span class="op">=</span><span class="va">b1</span>, fixed.a<span class="op">=</span><span class="va">a1</span><span class="op">)</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="sim.raschtype.html">sim.raschtype</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="va">prop</span><span class="op">)</span>, b<span class="op">=</span><span class="va">b2</span>, fixed.a<span class="op">=</span><span class="va">a2</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#**** model specification</span></span>
<span></span>
<span><span class="co">#*** define theta distribution</span></span>
<span><span class="va">TP</span> <span class="op">&lt;-</span> <span class="fl">21</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>,<span class="fl">6</span>,length<span class="op">=</span><span class="va">TP</span><span class="op">)</span></span>
<span><span class="co"># stack theta vectors below each others=&gt; 2 latent classes</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">theta</span> <span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co"># distribution of theta (i.e., N(0,1))</span></span>
<span><span class="va">w_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span><span class="va">w_theta</span> <span class="op">&lt;-</span> <span class="va">w_theta</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w_theta</span><span class="op">)</span></span>
<span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">p2_logis</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span> <span class="va">p2_logis</span> <span class="op">)</span></span>
<span>    <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">p2</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">p1</span><span class="op">*</span><span class="va">w_theta</span>, <span class="va">p2</span><span class="op">*</span><span class="va">w_theta</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">pi_Theta</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pi_Theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> p2_logis<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fl">.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                       P<span class="op">=</span><span class="va">P_Theta1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># IRF for 2-class mixture 2PL model</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a1<span class="op">=</span><span class="fl">1</span>, a2<span class="op">=</span><span class="fl">1</span>, b1<span class="op">=</span><span class="fl">0</span>, b2<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">P_2PLmix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">a1</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">a2</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">b1</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">b2</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="va">P1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span> <span class="va">a1</span><span class="op">*</span><span class="op">(</span><span class="va">Theta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">TP</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">b1</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">P2</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span> <span class="va">a2</span><span class="op">*</span><span class="op">(</span><span class="va">Theta</span><span class="op">[</span><span class="va">TP</span><span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">TP</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">b2</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">P1</span>, <span class="va">P2</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">P</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define some slightly informative prior of 2PL</span></span>
<span><span class="va">item_2PLmix</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"2PLmix"</span>, par<span class="op">=</span><span class="va">par</span>,</span>
<span>               est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_2PLmix</span> <span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_2PLmix</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#****************************************************************************</span></span>
<span><span class="co">#******* Model 1: 2PL mixture model</span></span>
<span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"2PLmix"</span>, <span class="va">I</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                        customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co">## EXAMPLE 5: Partial credit model with MML and PML</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.gpcm</span>, package<span class="op">=</span><span class="st">"TAM"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">data.gpcm</span></span>
<span></span>
<span><span class="co"># recode data and include some missings</span></span>
<span><span class="va">dat</span><span class="op">[</span> <span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">dat</span><span class="op">[</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">dat</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co">#------ Definition of item response functions</span></span>
<span><span class="co">#*** IRF 2PL</span></span>
<span><span class="va">P_2PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">P</span><span class="op">[</span>,<span class="va">cc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">b</span><span class="op">[</span><span class="va">cc</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">P_PCM2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu">P_2PL</span><span class="op">(</span>par<span class="op">=</span><span class="va">par</span>, Theta<span class="op">=</span><span class="va">Theta</span>, ncat<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">P_PCM3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu">P_2PL</span><span class="op">(</span>par<span class="op">=</span><span class="va">par</span>, Theta<span class="op">=</span><span class="va">Theta</span>, ncat<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define some slightly informative prior of 2PL</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> b1<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, b2<span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="va">NP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span></span>
<span><span class="va">item_PCM2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"PCM2"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="va">NP</span><span class="op">)</span>,</span>
<span>               P<span class="op">=</span><span class="va">P_PCM2</span> <span class="op">)</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> b1<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, b2<span class="op">=</span><span class="fl">0</span>, b3<span class="op">=</span><span class="fl">1</span> <span class="op">)</span> ; <span class="va">NP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span></span>
<span><span class="va">item_PCM3</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"PCM3"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="va">NP</span><span class="op">)</span>,</span>
<span>               P<span class="op">=</span><span class="va">P_PCM3</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_PCM2</span>,  <span class="va">item_PCM3</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#---- definition theta distribution</span></span>
<span><span class="co">#** theta grid</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>,<span class="fl">6</span>,length<span class="op">=</span><span class="fl">21</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#** theta distribution</span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fl">0</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">G</span><span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu</span>, sd<span class="op">=</span><span class="va">sigma</span> <span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="va">pi1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pi1</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pi1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pi_Theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#** create distribution class</span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"mu"</span><span class="op">=</span><span class="fl">0</span>, <span class="st">"sigma"</span><span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                       P<span class="op">=</span><span class="va">P_Theta1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#-- create parameter table</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCM2"</span>, <span class="st">"PCM3"</span>, <span class="st">"PCM3"</span><span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                        customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#***** Model 1: MML</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***** Model 2: PML</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">I</span><span class="op">)</span></span>
<span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="va">W2</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">W2</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pml_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>W1<span class="op">=</span><span class="va">W1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span>, W2<span class="op">=</span><span class="va">W2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">mod1</span><span class="op">$</span><span class="va">customTheta</span>,</span>
<span>                   estimator<span class="op">=</span><span class="st">"PML"</span>, pml_args<span class="op">=</span><span class="va">pml_args</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># variance matrix</span></span>
<span><span class="va">smod2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt_sandwich_pml</span><span class="op">(</span>object<span class="op">=</span><span class="va">mod2</span><span class="op">)</span></span>
<span><span class="va">smod2</span></span>
<span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co">## EXAMPLE 6: Person covariates for item parameters and trait distribution</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="co">#-- simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2025</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>,len<span class="op">=</span><span class="va">I</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="va">b</span></span>
<span><span class="va">b1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="sim.raschtype.html">sim.raschtype</a></span><span class="op">(</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, b<span class="op">=</span><span class="va">b</span> <span class="op">)</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="sim.raschtype.html">sim.raschtype</a></span><span class="op">(</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">1</span>, sd<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>, b<span class="op">=</span><span class="va">b1</span> <span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, each<span class="op">=</span><span class="va">N</span><span class="op">)</span>, <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***************************************************************************</span></span>
<span><span class="co">#***** Model 1: two-group Rasch model</span></span>
<span></span>
<span><span class="co">#*** IRF 1PL</span></span>
<span><span class="va">P_1PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">ncat</span><span class="op">)</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">ncat</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">P</span><span class="op">[</span>,<span class="va">cc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="op">(</span><span class="va">cc</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">b</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="va">P</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#** create item classes of 1PL and 2PL models</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> b<span class="op">=</span><span class="fl">0</span> <span class="op">)</span></span>
<span><span class="va">item_1PL</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"1PL"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_1PL</span> <span class="op">)</span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_1PL</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#---- definition theta distribution</span></span>
<span></span>
<span><span class="co">#** theta grid</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>,<span class="fl">6</span>,length<span class="op">=</span><span class="fl">21</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#** theta distribution</span></span>
<span><span class="va">P_Theta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">mu1</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">sigma1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fl">0</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">G</span><span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu1</span>, sd<span class="op">=</span><span class="va">sigma1</span> <span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="va">pi1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pi1</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pi1</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span> <span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu2</span>, sd<span class="op">=</span><span class="va">sigma2</span> <span class="op">)</span></span>
<span>    <span class="va">pi1</span> <span class="op">&lt;-</span> <span class="va">pi1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pi1</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pi1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pi_Theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#** create distribution class</span></span>
<span><span class="va">par_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"mu1"</span><span class="op">=</span><span class="fl">0</span>, <span class="st">"sigma1"</span><span class="op">=</span><span class="fl">1</span>, <span class="st">"mu2"</span><span class="op">=</span><span class="fl">0</span>, <span class="st">"sigma2"</span><span class="op">=</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="va">customTheta</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta</span>,</span>
<span>                       est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span>, P<span class="op">=</span><span class="va">P_Theta1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#-- create parameter table</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"1PL"</span>, <span class="va">I</span> <span class="op">)</span></span>
<span><span class="va">partable</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                        customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate model</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable</span>, group<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">group</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***************************************************************************</span></span>
<span><span class="co">#***** Model 2: Rasch model with person covariates in trait distribution</span></span>
<span></span>
<span><span class="co">#- matrix with person covariates</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>,<span class="st">"group"</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#** theta distribution</span></span>
<span><span class="va">P_Theta2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">G</span>, <span class="va">X</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">mu1</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">sigma1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">.01</span> <span class="op">)</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fl">0</span>, nrow<span class="op">=</span><span class="va">TP</span>, ncol<span class="op">=</span><span class="va">N</span><span class="op">)</span></span>
<span>    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span> <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span> <span class="op">]</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span> <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">2</span> <span class="op">]</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">tt</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">TP</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">pi_Theta</span><span class="op">[</span><span class="va">tt</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">[</span><span class="va">tt</span>,<span class="fl">1</span><span class="op">]</span>, mean<span class="op">=</span><span class="va">mu</span>, sd<span class="op">=</span><span class="va">sigma</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="sirt-utilities.html">sirt_matrix2</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">pi_Theta</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">TP</span><span class="op">)</span></span>
<span>    <span class="va">pi_Theta</span> <span class="op">&lt;-</span> <span class="va">pi_Theta</span> <span class="op">/</span> <span class="op">(</span> <span class="va">cp</span> <span class="op">+</span> <span class="fl">1e-80</span> <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pi_Theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">par_Theta2</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">customTheta</span><span class="op">$</span><span class="va">par</span></span>
<span></span>
<span><span class="va">customTheta2</span>  <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createThetaDistribution.html">xxirt_createThetaDistribution</a></span><span class="op">(</span> par<span class="op">=</span><span class="va">par_Theta2</span>,</span>
<span>                       est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                       P<span class="op">=</span><span class="va">P_Theta2</span>, X<span class="op">=</span><span class="va">X</span>, lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">0.01</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">partable2</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">partable</span></span>
<span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable2</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***************************************************************************</span></span>
<span><span class="co">#***** Model 3: Rasch model with person covariates in trait distribution and</span></span>
<span><span class="co">#*****          item parameters</span></span>
<span></span>
<span><span class="co">#*** IRF 1PL</span></span>
<span><span class="va">P_1PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">par</span>, <span class="va">Theta</span>, <span class="va">ncat</span>, <span class="va">X</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">TP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>    <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span> <span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">TP</span>,<span class="va">ncat</span>,<span class="va">N</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">efficient</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span> <span class="va">efficient</span> <span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">bM</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="sirt-utilities.html">sirt_matrix2</a></span><span class="op">(</span> <span class="va">par</span><span class="op">[</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">]</span>, nrow<span class="op">=</span><span class="va">TP</span><span class="op">)</span></span>
<span>        <span class="va">P1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">bM</span> <span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">Theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">h2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="sirt-utilities.html">sirt_matrix2</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">par</span><span class="op">[</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">]</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">TP</span><span class="op">)</span></span>
<span>        <span class="va">P1</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span> <span class="op">(</span> <span class="fl">1</span><span class="op">+</span><span class="va">h1</span><span class="op">*</span><span class="va">h2</span> <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">P1</span></span>
<span>    <span class="va">P</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">P</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#** create item classes of 1PL and 2PL models</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> b1<span class="op">=</span><span class="fl">0</span>, b2<span class="op">=</span><span class="op">-</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="va">item_1PL</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createDiscItem</a></span><span class="op">(</span> name<span class="op">=</span><span class="st">"1PL"</span>, par<span class="op">=</span><span class="va">par</span>, est<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                            P<span class="op">=</span><span class="va">P_1PL</span>, X<span class="op">=</span><span class="va">X</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">customItems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">item_1PL</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#-- create parameter table</span></span>
<span><span class="va">itemtype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="st">"1PL"</span>, <span class="va">I</span> <span class="op">)</span></span>
<span><span class="va">partable2</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="xxirt_createParTable.html">xxirt_createParTable</a></span><span class="op">(</span> <span class="va">dat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, itemtype<span class="op">=</span><span class="va">itemtype</span>,</span>
<span>                        customItems<span class="op">=</span><span class="va">customItems</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#-- distribution parameters</span></span>
<span><span class="va">customTheta2b</span> <span class="op">&lt;-</span> <span class="va">mod2</span><span class="op">$</span><span class="va">customTheta</span></span>
<span><span class="va">customTheta2b</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>      <span class="co"># fix mu2 to 0</span></span>
<span><span class="va">customTheta2b</span><span class="op">$</span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate model</span></span>
<span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu">xxirt</span><span class="op">(</span> dat<span class="op">=</span><span class="va">resp</span>, Theta<span class="op">=</span><span class="va">Theta</span>, partable<span class="op">=</span><span class="va">partable2</span>,</span>
<span>                   customItems<span class="op">=</span><span class="va">customItems</span>, customTheta<span class="op">=</span><span class="va">customTheta2b</span>, mstep_iter<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Alexander Robitzsch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

